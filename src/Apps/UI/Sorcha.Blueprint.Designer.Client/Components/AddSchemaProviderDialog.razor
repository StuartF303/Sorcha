@using Sorcha.Blueprint.Designer.Client.Models

<MudDialog>
    <TitleContent>
        <div class="d-flex align-center justify-space-between" style="width: 100%;">
            <MudText Typo="Typo.h6">
                <MudIcon Icon="@Icons.Material.Filled.Add" Class="mr-2" />
                Add Schema Provider
            </MudText>
            <div>
                <MudIconButton Icon="@Icons.Material.Filled.Save"
                               Color="Color.Success"
                               Size="Size.Small"
                               OnClick="Submit"
                               Disabled="@(!IsValid())"
                               Title="Add provider" />
                <MudIconButton Icon="@Icons.Material.Filled.Close"
                               Color="Color.Default"
                               Size="Size.Small"
                               OnClick="Cancel"
                               Title="Close without adding" />
            </div>
        </div>
    </TitleContent>
    <DialogContent>
        <MudTextField @bind-Value="provider.Name"
                      Label="Name"
                      Variant="Variant.Outlined"
                      Class="mb-3"
                      Required="true"
                      HelperText="Display name for the provider" />

        <MudTextField @bind-Value="provider.Uri"
                      Label="URI"
                      Variant="Variant.Outlined"
                      Class="mb-3"
                      Required="true"
                      HelperText="Base URI for the schema provider (e.g., https://example.com/schemas)" />

        <MudTextField @bind-Value="provider.Description"
                      Label="Description"
                      Variant="Variant.Outlined"
                      Lines="3"
                      HelperText="Brief description of what schemas this provider offers" />

        <MudSwitch @bind-Value="provider.IsEnabled"
                   Label="Enable this provider"
                   Color="Color.Success"
                   Class="mt-3" />
    </DialogContent>
</MudDialog>

@code {
    [CascadingParameter]
    MudBlazor.IDialogReference? MudDialog { get; set; }

    private SchemaProvider provider = new()
    {
        IsEnabled = true,
        IsBuiltIn = false
    };

    private bool IsValid()
    {
        return !string.IsNullOrWhiteSpace(provider.Name) &&
               !string.IsNullOrWhiteSpace(provider.Uri) &&
               Uri.TryCreate(provider.Uri, UriKind.Absolute, out _);
    }

    private void Submit()
    {
        if (IsValid())
        {
            MudDialog?.Close(DialogResult.Ok(provider));
        }
    }

    private void Cancel()
    {
        MudDialog?.Close(DialogResult.Cancel());
    }
}
