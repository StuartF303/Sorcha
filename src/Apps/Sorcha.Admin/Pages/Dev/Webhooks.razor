@page "/dev/webhooks"
@rendermode @(new InteractiveServerRenderMode(prerender: false))
@attribute [Authorize]
@attribute [Authorize(Roles = "Developer,Administrator")]

<PageTitle>Webhooks - Sorcha Platform</PageTitle>

<MudContainer MaxWidth="MaxWidth.ExtraLarge" Class="mt-4">
    <MudText Typo="Typo.h4" Class="mb-2">
        <MudIcon Icon="@Icons.Material.Filled.Webhook" Class="mr-2" />
        Webhooks
    </MudText>
    <MudText Typo="Typo.body1" Color="Color.Secondary" Class="mb-4">
        Manage webhook subscriptions and event notifications
    </MudText>

    <MudGrid>
        <MudItem xs="12">
            <MudPaper Class="pa-4 mb-4" Elevation="2">
                <div class="d-flex justify-space-between align-center mb-3">
                    <MudText Typo="Typo.h6">Active Webhooks</MudText>
                    <MudButton Color="Color.Primary" Variant="Variant.Filled" StartIcon="@Icons.Material.Filled.Add">
                        Add Webhook
                    </MudButton>
                </div>

                <MudTable Items="@webhooks" Hover="true">
                    <HeaderContent>
                        <MudTh>Name</MudTh>
                        <MudTh>URL</MudTh>
                        <MudTh>Events</MudTh>
                        <MudTh>Status</MudTh>
                        <MudTh>Last Trigger</MudTh>
                        <MudTh>Actions</MudTh>
                    </HeaderContent>
                    <RowTemplate>
                        <MudTd>@context.Name</MudTd>
                        <MudTd Style="font-family: monospace; font-size: 0.85rem;">@context.Url</MudTd>
                        <MudTd>
                            @foreach (var evt in context.Events)
                            {
                                <MudChip T="string" Size="Size.Small" Color="Color.Info">@evt</MudChip>
                            }
                        </MudTd>
                        <MudTd>
                            <MudChip T="string" Size="Size.Small" Color="@(context.IsActive ? Color.Success : Color.Default)">
                                @(context.IsActive ? "Active" : "Inactive")
                            </MudChip>
                        </MudTd>
                        <MudTd>@context.LastTrigger.ToString("MMM dd, HH:mm")</MudTd>
                        <MudTd>
                            <MudIconButton Icon="@Icons.Material.Filled.Edit" Size="Size.Small" Color="Color.Primary" />
                            <MudIconButton Icon="@Icons.Material.Filled.PlayArrow" Size="Size.Small" Color="Color.Success" Title="Test" />
                            <MudIconButton Icon="@Icons.Material.Filled.Delete" Size="Size.Small" Color="Color.Error" />
                        </MudTd>
                    </RowTemplate>
                </MudTable>
            </MudPaper>
        </MudItem>

        <MudItem xs="12">
            <MudPaper Class="pa-4" Elevation="2">
                <MudText Typo="Typo.h6" Class="mb-3">Available Events</MudText>
                <MudGrid>
                    <MudItem xs="12" md="6">
                        <MudText Typo="Typo.subtitle2" Class="mb-2">Blueprint Events</MudText>
                        <MudChipSet T="string">
                            <MudChip T="string" Size="Size.Small">blueprint.created</MudChip>
                            <MudChip T="string" Size="Size.Small">blueprint.updated</MudChip>
                            <MudChip T="string" Size="Size.Small">blueprint.executed</MudChip>
                            <MudChip T="string" Size="Size.Small">blueprint.deleted</MudChip>
                        </MudChipSet>
                    </MudItem>
                    <MudItem xs="12" md="6">
                        <MudText Typo="Typo.subtitle2" Class="mb-2">Wallet Events</MudText>
                        <MudChipSet T="string">
                            <MudChip T="string" Size="Size.Small">wallet.created</MudChip>
                            <MudChip T="string" Size="Size.Small">transaction.signed</MudChip>
                        </MudChipSet>
                    </MudItem>
                    <MudItem xs="12" md="6">
                        <MudText Typo="Typo.subtitle2" Class="mb-2">Register Events</MudText>
                        <MudChipSet T="string">
                            <MudChip T="string" Size="Size.Small">transaction.created</MudChip>
                            <MudChip T="string" Size="Size.Small">transaction.confirmed</MudChip>
                        </MudChipSet>
                    </MudItem>
                    <MudItem xs="12" md="6">
                        <MudText Typo="Typo.subtitle2" Class="mb-2">System Events</MudText>
                        <MudChipSet T="string">
                            <MudChip T="string" Size="Size.Small">user.created</MudChip>
                            <MudChip T="string" Size="Size.Small">tenant.created</MudChip>
                        </MudChipSet>
                    </MudItem>
                </MudGrid>
            </MudPaper>
        </MudItem>

        <MudItem xs="12">
            <MudAlert Severity="Severity.Info">
                <MudText Typo="Typo.body2">
                    This is a placeholder page. Full webhook management with event subscriptions will be implemented in future versions.
                </MudText>
            </MudAlert>
        </MudItem>
    </MudGrid>
</MudContainer>

@code {
    private List<WebhookItem> webhooks = new()
    {
        new WebhookItem { Name = "Slack Notifications", Url = "https://hooks.slack.com/services/...", Events = new[] { "blueprint.created", "transaction.confirmed" }, IsActive = true, LastTrigger = DateTime.Now.AddHours(-2) },
        new WebhookItem { Name = "External API", Url = "https://api.example.com/webhook", Events = new[] { "wallet.created" }, IsActive = true, LastTrigger = DateTime.Now.AddDays(-1) },
        new WebhookItem { Name = "Analytics System", Url = "https://analytics.internal/events", Events = new[] { "blueprint.executed", "transaction.created" }, IsActive = false, LastTrigger = DateTime.Now.AddDays(-7) },
    };

    public class WebhookItem
    {
        public string Name { get; set; } = "";
        public string Url { get; set; } = "";
        public string[] Events { get; set; } = Array.Empty<string>();
        public bool IsActive { get; set; }
        public DateTime LastTrigger { get; set; }
    }
}
