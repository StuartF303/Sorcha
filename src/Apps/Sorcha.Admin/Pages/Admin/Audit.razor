@page "/admin/audit"
@attribute [Authorize(Roles = "Administrator,SystemAdmin")]

<PageTitle>Audit Logs - Sorcha Platform</PageTitle>

<MudContainer MaxWidth="MaxWidth.ExtraLarge" Class="mt-4">
    <MudText Typo="Typo.h4" Class="mb-2">
        <MudIcon Icon="@Icons.Material.Filled.History" Class="mr-2" />
        Audit Logs
    </MudText>
    <MudText Typo="Typo.body1" Color="Color.Secondary" Class="mb-4">
        View system audit trail and event logs
    </MudText>

    <MudGrid>
        <MudItem xs="12">
            <MudPaper Class="pa-4 mb-4" Elevation="2">
                <MudText Typo="Typo.h6" Class="mb-3">Filters</MudText>
                <MudGrid>
                    <MudItem xs="12" sm="6" md="3">
                        <MudSelect T="string" Label="Severity" Variant="Variant.Outlined" Dense="true">
                            <MudSelectItem Value="@("All")">All</MudSelectItem>
                            <MudSelectItem Value="@("Info")">Info</MudSelectItem>
                            <MudSelectItem Value="@("Warning")">Warning</MudSelectItem>
                            <MudSelectItem Value="@("Error")">Error</MudSelectItem>
                        </MudSelect>
                    </MudItem>
                    <MudItem xs="12" sm="6" md="3">
                        <MudSelect T="string" Label="Service" Variant="Variant.Outlined" Dense="true">
                            <MudSelectItem Value="@("All")">All Services</MudSelectItem>
                            <MudSelectItem Value="@("Blueprint")">Blueprint Service</MudSelectItem>
                            <MudSelectItem Value="@("Wallet")">Wallet Service</MudSelectItem>
                            <MudSelectItem Value="@("Register")">Register Service</MudSelectItem>
                        </MudSelect>
                    </MudItem>
                    <MudItem xs="12" sm="6" md="3">
                        <MudDatePicker Label="From Date" Variant="Variant.Outlined" Dense="true" />
                    </MudItem>
                    <MudItem xs="12" sm="6" md="3">
                        <MudDatePicker Label="To Date" Variant="Variant.Outlined" Dense="true" />
                    </MudItem>
                </MudGrid>
            </MudPaper>
        </MudItem>

        <MudItem xs="12">
            <MudPaper Class="pa-4" Elevation="2">
                <MudText Typo="Typo.h6" Class="mb-3">Recent Events</MudText>

                <MudTable Items="@auditLogs" Hover="true" Dense="true">
                    <HeaderContent>
                        <MudTh>Timestamp</MudTh>
                        <MudTh>Severity</MudTh>
                        <MudTh>Service</MudTh>
                        <MudTh>User</MudTh>
                        <MudTh>Event</MudTh>
                        <MudTh>Actions</MudTh>
                    </HeaderContent>
                    <RowTemplate>
                        <MudTd>@context.Timestamp.ToString("MMM dd HH:mm:ss")</MudTd>
                        <MudTd>
                            <MudChip T="string" Size="Size.Small" Color="@context.SeverityColor">@context.Severity</MudChip>
                        </MudTd>
                        <MudTd>@context.Service</MudTd>
                        <MudTd>@context.User</MudTd>
                        <MudTd>@context.Event</MudTd>
                        <MudTd>
                            <MudIconButton Icon="@Icons.Material.Filled.Visibility" Size="Size.Small" Color="Color.Primary" />
                        </MudTd>
                    </RowTemplate>
                </MudTable>
            </MudPaper>
        </MudItem>

        <MudItem xs="12">
            <MudAlert Severity="Severity.Info">
                <MudText Typo="Typo.body2">
                    This is a placeholder page. Full audit logging with filtering and export capabilities will be implemented in future versions.
                </MudText>
            </MudAlert>
        </MudItem>
    </MudGrid>
</MudContainer>

@code {
    private List<AuditLogItem> auditLogs = new()
    {
        new AuditLogItem { Timestamp = DateTime.Now.AddMinutes(-5), Severity = "Info", SeverityColor = Color.Info, Service = "Blueprint", User = "john@example.com", Event = "Blueprint created" },
        new AuditLogItem { Timestamp = DateTime.Now.AddMinutes(-10), Severity = "Info", SeverityColor = Color.Info, Service = "Wallet", User = "jane@example.com", Event = "Wallet created" },
        new AuditLogItem { Timestamp = DateTime.Now.AddMinutes(-15), Severity = "Warning", SeverityColor = Color.Warning, Service = "Register", User = "system", Event = "Transaction validation slow" },
        new AuditLogItem { Timestamp = DateTime.Now.AddMinutes(-20), Severity = "Info", SeverityColor = Color.Info, Service = "Peer", User = "bob@example.com", Event = "Peer connected" },
        new AuditLogItem { Timestamp = DateTime.Now.AddHours(-1), Severity = "Error", SeverityColor = Color.Error, Service = "Blueprint", User = "alice@example.com", Event = "Blueprint validation failed" },
    };

    public class AuditLogItem
    {
        public DateTime Timestamp { get; set; }
        public string Severity { get; set; } = "";
        public Color SeverityColor { get; set; }
        public string Service { get; set; } = "";
        public string User { get; set; } = "";
        public string Event { get; set; } = "";
    }
}
