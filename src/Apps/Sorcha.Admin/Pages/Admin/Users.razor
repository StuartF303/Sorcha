@page "/admin/users"
@rendermode @(new InteractiveServerRenderMode(prerender: false))
@attribute [Authorize]
@attribute [Authorize(Roles = "Administrator,SystemAdmin")]

<PageTitle>User Management - Sorcha Platform</PageTitle>

<MudContainer MaxWidth="MaxWidth.ExtraLarge" Class="mt-4">
    <MudText Typo="Typo.h4" Class="mb-2">
        <MudIcon Icon="@Icons.Material.Filled.People" Class="mr-2" />
        User Management
    </MudText>
    <MudText Typo="Typo.body1" Color="Color.Secondary" Class="mb-4">
        Manage users, roles, and permissions
    </MudText>

    <MudGrid>
        <MudItem xs="12">
            <MudPaper Class="pa-4" Elevation="2">
                <div class="d-flex justify-space-between align-center mb-3">
                    <MudText Typo="Typo.h6">All Users</MudText>
                    <MudButton Color="Color.Primary" Variant="Variant.Filled" StartIcon="@Icons.Material.Filled.Add">
                        Add User
                    </MudButton>
                </div>

                <MudTable Items="@users" Hover="true" Striped="true">
                    <HeaderContent>
                        <MudTh>Name</MudTh>
                        <MudTh>Email</MudTh>
                        <MudTh>Roles</MudTh>
                        <MudTh>Status</MudTh>
                        <MudTh>Last Login</MudTh>
                        <MudTh>Actions</MudTh>
                    </HeaderContent>
                    <RowTemplate>
                        <MudTd>@context.Name</MudTd>
                        <MudTd>@context.Email</MudTd>
                        <MudTd>
                            @foreach (var role in context.Roles)
                            {
                                <MudChip T="string" Size="Size.Small" Color="@GetRoleColor(role)">@role</MudChip>
                            }
                        </MudTd>
                        <MudTd>
                            <MudChip T="string" Size="Size.Small" Color="@(context.IsActive ? Color.Success : Color.Default)">
                                @(context.IsActive ? "Active" : "Inactive")
                            </MudChip>
                        </MudTd>
                        <MudTd>@context.LastLogin.ToString("MMM dd, yyyy")</MudTd>
                        <MudTd>
                            <MudIconButton Icon="@Icons.Material.Filled.Edit" Size="Size.Small" Color="Color.Primary" />
                            <MudIconButton Icon="@Icons.Material.Filled.Delete" Size="Size.Small" Color="Color.Error" />
                        </MudTd>
                    </RowTemplate>
                </MudTable>
            </MudPaper>
        </MudItem>

        <MudItem xs="12">
            <MudAlert Severity="Severity.Info">
                <MudText Typo="Typo.body2">
                    This is a placeholder page. Full user management with Tenant Service integration will be implemented in future versions.
                </MudText>
            </MudAlert>
        </MudItem>
    </MudGrid>
</MudContainer>

@code {
    private List<UserItem> users = new()
    {
        new UserItem { Name = "John Doe", Email = "john@example.com", Roles = new[] { "Administrator", "Designer" }, IsActive = true, LastLogin = DateTime.Now.AddHours(-2) },
        new UserItem { Name = "Jane Smith", Email = "jane@example.com", Roles = new[] { "Designer" }, IsActive = true, LastLogin = DateTime.Now.AddDays(-1) },
        new UserItem { Name = "Bob Johnson", Email = "bob@example.com", Roles = new[] { "Consumer" }, IsActive = true, LastLogin = DateTime.Now.AddDays(-3) },
        new UserItem { Name = "Alice Williams", Email = "alice@example.com", Roles = new[] { "Developer" }, IsActive = false, LastLogin = DateTime.Now.AddDays(-15) },
    };

    private Color GetRoleColor(string role)
    {
        return role?.ToLower() switch
        {
            "administrator" or "systemadmin" => Color.Error,
            "designer" => Color.Primary,
            "consumer" or "user" => Color.Success,
            "developer" => Color.Info,
            _ => Color.Default
        };
    }

    public class UserItem
    {
        public string Name { get; set; } = "";
        public string Email { get; set; } = "";
        public string[] Roles { get; set; } = Array.Empty<string>();
        public bool IsActive { get; set; }
        public DateTime LastLogin { get; set; }
    }
}
