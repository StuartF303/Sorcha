@page "/settings"
@rendermode InteractiveWebAssembly
@attribute [Authorize]
@using Sorcha.Admin.Models
@using Sorcha.Admin.Models.Configuration
@using Sorcha.Admin.Components
@using Sorcha.Admin.Components.Configuration
@using Sorcha.Admin.Services.Configuration
@using Sorcha.Admin.Services
@using Blazored.LocalStorage
@using System.Text.Json
@inject ILocalStorageService LocalStorage
@inject IConfigurationService ConfigService
@inject IBlueprintStorageService BlueprintStorage
@inject IOfflineSyncService SyncService
@inject ISnackbar Snackbar
@inject NavigationManager Navigation

<PageTitle>Settings - Blueprint Designer</PageTitle>

<MudContainer MaxWidth="MaxWidth.Large" Class="mt-4">
    <MudPaper Class="pa-4">
        <MudText Typo="Typo.h4" Class="mb-4">
            <MudIcon Icon="@Icons.Material.Filled.Settings" Class="mr-2" />
            Application Settings
        </MudText>

        <MudTabs Elevation="2" Rounded="true" ApplyEffectsToContainer="true" PanelClass="pa-4">
            <!-- Schema Providers Tab -->
            <MudTabPanel Text="Schema Providers" Icon="@Icons.Material.Filled.Cloud">
                <MudText Typo="Typo.body1" Class="mb-4">
                    Configure external schema provider sources. These providers allow you to import schemas from remote repositories.
                </MudText>

                @if (schemaProviders.Any())
                {
                    <MudTable Items="@schemaProviders" Hover="true" Breakpoint="Breakpoint.Sm" Dense="true">
                        <HeaderContent>
                            <MudTh>Enabled</MudTh>
                            <MudTh>Name</MudTh>
                            <MudTh>URI</MudTh>
                            <MudTh>Description</MudTh>
                            <MudTh>Actions</MudTh>
                        </HeaderContent>
                        <RowTemplate>
                            <MudTd DataLabel="Enabled">
                                <MudSwitch T="bool" Value="context.IsEnabled"
                                           Color="Color.Success"
                                           Size="Size.Small"
                                           T="bool"
                                           ValueChanged="@((bool newValue) => { context.IsEnabled = newValue; _ = SaveSchemaProviders(); })" />
                            </MudTd>
                            <MudTd DataLabel="Name">
                                <MudText>
                                    @context.Name
                                    @if (context.IsBuiltIn)
                                    {
                                        <MudChip T="string" Size="Size.Small" Color="Color.Info" Class="ml-2">Built-in</MudChip>
                                    }
                                </MudText>
                            </MudTd>
                            <MudTd DataLabel="URI">
                                <MudLink Href="@context.Uri" Target="_blank">@context.Uri</MudLink>
                            </MudTd>
                            <MudTd DataLabel="Description">@context.Description</MudTd>
                            <MudTd DataLabel="Actions">
                                @if (!context.IsBuiltIn)
                                {
                                    <MudIconButton Icon="@Icons.Material.Filled.Delete"
                                                   Color="Color.Error"
                                                   Size="Size.Small"
                                                   OnClick="@(() => DeleteProvider(context.Id))" />
                                }
                            </MudTd>
                        </RowTemplate>
                    </MudTable>
                }
                else
                {
                    <MudAlert Severity="Severity.Info">No schema providers configured.</MudAlert>
                }

                <MudButton StartIcon="@Icons.Material.Filled.Add"
                           Color="Color.Primary"
                           Variant="Variant.Filled"
                           OnClick="OpenAddProviderDialog"
                           Class="mt-4">
                    Add Schema Provider
                </MudButton>
            </MudTabPanel>

            <!-- Color Scheme Tab -->
            <MudTabPanel Text="Appearance" Icon="@Icons.Material.Filled.Palette">
                <MudText Typo="Typo.h6" Class="mb-3">Color Scheme</MudText>
                <MudText Typo="Typo.body2" Color="Color.Secondary" Class="mb-4">
                    Customize the appearance of the Blueprint Designer
                </MudText>

                <MudRadioGroup @bind-Value="selectedTheme">
                    <MudRadio Value="@("light")" Color="Color.Primary">
                        <div class="d-flex align-center">
                            <MudIcon Icon="@Icons.Material.Filled.LightMode" Class="mr-2" />
                            Light Theme
                        </div>
                    </MudRadio>
                    <MudRadio Value="@("dark")" Color="Color.Primary">
                        <div class="d-flex align-center">
                            <MudIcon Icon="@Icons.Material.Filled.DarkMode" Class="mr-2" />
                            Dark Theme
                        </div>
                    </MudRadio>
                    <MudRadio Value="@("auto")" Color="Color.Primary">
                        <div class="d-flex align-center">
                            <MudIcon Icon="@Icons.Material.Filled.Brightness4" Class="mr-2" />
                            Auto (System Preference)
                        </div>
                    </MudRadio>
                </MudRadioGroup>

                <MudDivider Class="my-4" />

                <MudText Typo="Typo.h6" Class="mb-3">Canvas Settings</MudText>
                <MudSwitch T="bool" @bind-Value="showGrid"
                           Label="Show Grid"
                           Color="Color.Primary"
                           Class="mb-2" />
                <MudSwitch T="bool" @bind-Value="snapToGrid"
                           Label="Snap to Grid"
                           Color="Color.Primary" />

                <MudButton StartIcon="@Icons.Material.Filled.Save"
                           Color="Color.Success"
                           Variant="Variant.Filled"
                           OnClick="SaveAppearanceSettings"
                           Class="mt-4">
                    Save Appearance Settings
                </MudButton>
            </MudTabPanel>

            <!-- Configuration Tab -->
            <MudTabPanel Text="Configuration" Icon="@Icons.Material.Filled.Dns">
                <MudText Typo="Typo.body1" Class="mb-4">
                    Manage connection profiles for different Sorcha environments (dev, staging, production).
                </MudText>

                <!-- Active Profile Display -->
                <MudAlert Severity="Severity.Info" Class="mb-4">
                    <div class="d-flex align-center">
                        <MudIcon Icon="@Icons.Material.Filled.CheckCircle" Class="mr-2" />
                        <div>
                            <strong>Active Profile:</strong> @(_activeProfile?.Name ?? "None")
                            @if (_activeProfile != null)
                            {
                                <br />
                                <MudText Typo="Typo.caption">
                                    Tenant Service: @_activeProfile.TenantServiceUrl
                                </MudText>
                            }
                        </div>
                    </div>
                </MudAlert>

                <!-- Profile List -->
                @if (_profiles.Any())
                {
                    <MudTable Items="@_profiles.Values.OrderBy(p => p.Name)" Hover="true" Breakpoint="Breakpoint.Sm" Dense="true">
                        <HeaderContent>
                            <MudTh>Profile</MudTh>
                            <MudTh>Tenant Service URL</MudTh>
                            <MudTh>Verify SSL</MudTh>
                            <MudTh>Actions</MudTh>
                        </HeaderContent>
                        <RowTemplate>
                            <MudTd DataLabel="Profile">
                                <div class="d-flex align-center">
                                    @context.Name
                                    @if (context.Name == _config?.ActiveProfile)
                                    {
                                        <MudChip T="string" Size="Size.Small" Color="Color.Success" Class="ml-2">
                                            Active
                                        </MudChip>
                                    }
                                </div>
                            </MudTd>
                            <MudTd DataLabel="Tenant Service URL">
                                <MudText Typo="Typo.body2">@context.TenantServiceUrl</MudText>
                            </MudTd>
                            <MudTd DataLabel="Verify SSL">
                                <MudIcon Icon="@(context.VerifySsl ? Icons.Material.Filled.Check : Icons.Material.Filled.Close)"
                                         Color="@(context.VerifySsl ? Color.Success : Color.Warning)" />
                            </MudTd>
                            <MudTd DataLabel="Actions">
                                <MudIconButton Icon="@Icons.Material.Filled.Edit" Size="Size.Small"
                                               OnClick="@(() => EditProfile(context))"
                                               Title="Edit profile" />
                                <MudIconButton Icon="@Icons.Material.Filled.Delete" Size="Size.Small"
                                               Color="Color.Error"
                                               OnClick="@(() => DeleteProfile(context.Name))"
                                               Disabled="@(context.Name == _config?.ActiveProfile)"
                                               Title="@(context.Name == _config?.ActiveProfile ? "Cannot delete active profile" : "Delete profile")" />
                            </MudTd>
                        </RowTemplate>
                    </MudTable>
                }
                else
                {
                    <MudAlert Severity="Severity.Info">No profiles configured.</MudAlert>
                }

                <MudButton StartIcon="@Icons.Material.Filled.Add" Color="Color.Primary"
                           Variant="Variant.Filled" OnClick="CreateNewProfile" Class="mt-4">
                    New Profile
                </MudButton>
            </MudTabPanel>

            <!-- Data & Storage Tab -->
            <MudTabPanel Text="Data & Storage" Icon="@Icons.Material.Filled.Storage">
                <MudText Typo="Typo.h6" Class="mb-3">Local Storage Management</MudText>
                <MudText Typo="Typo.body2" Color="Color.Secondary" Class="mb-4">
                    Manage locally cached data. Clearing the cache will remove offline data but won't affect server-stored blueprints.
                </MudText>

                <MudGrid>
                    <MudItem xs="12" md="6">
                        <MudCard Elevation="0" Outlined="true">
                            <MudCardHeader>
                                <CardHeaderContent>
                                    <MudText Typo="Typo.subtitle1">
                                        <MudIcon Icon="@Icons.Material.Filled.Cached" Size="Size.Small" Class="mr-1" />
                                        Blueprint Cache
                                    </MudText>
                                </CardHeaderContent>
                            </MudCardHeader>
                            <MudCardContent>
                                <MudText Typo="Typo.body2" Color="Color.Secondary" Class="mb-3">
                                    Clear locally cached blueprints. Server data will remain intact.
                                </MudText>
                                <MudButton OnClick="ClearBlueprintCache"
                                           Color="Color.Warning"
                                           Variant="Variant.Outlined"
                                           StartIcon="@Icons.Material.Filled.DeleteSweep"
                                           Disabled="_clearingCache">
                                    @if (_clearingCache)
                                    {
                                        <MudProgressCircular Size="Size.Small" Indeterminate="true" Class="mr-2" />
                                        <text>Clearing...</text>
                                    }
                                    else
                                    {
                                        <text>Clear Blueprint Cache</text>
                                    }
                                </MudButton>
                            </MudCardContent>
                        </MudCard>
                    </MudItem>

                    <MudItem xs="12" md="6">
                        <MudCard Elevation="0" Outlined="true">
                            <MudCardHeader>
                                <CardHeaderContent>
                                    <MudText Typo="Typo.subtitle1">
                                        <MudIcon Icon="@Icons.Material.Filled.Sync" Size="Size.Small" Class="mr-1" />
                                        Sync Queue
                                    </MudText>
                                </CardHeaderContent>
                            </MudCardHeader>
                            <MudCardContent>
                                <MudText Typo="Typo.body2" Color="Color.Secondary" Class="mb-2">
                                    Pending sync items: <strong>@_pendingSyncCount</strong>
                                </MudText>
                                <MudText Typo="Typo.body2" Color="Color.Secondary" Class="mb-3">
                                    Clear all queued offline changes. This will discard unsaved changes.
                                </MudText>
                                <MudButton OnClick="ClearSyncQueue"
                                           Color="Color.Error"
                                           Variant="Variant.Outlined"
                                           StartIcon="@Icons.Material.Filled.Clear"
                                           Disabled="@(_pendingSyncCount == 0)">
                                    Clear Sync Queue
                                </MudButton>
                            </MudCardContent>
                        </MudCard>
                    </MudItem>

                    <MudItem xs="12">
                        <MudDivider Class="my-4" />
                        <MudAlert Severity="Severity.Warning" Class="mb-4">
                            <MudText Typo="Typo.subtitle2">Clear All Local Data</MudText>
                            <MudText Typo="Typo.body2" Class="mb-2">
                                This will reset all local settings, caches, and unsaved changes. Your server-stored blueprints will not be affected.
                            </MudText>
                            <MudButton OnClick="ClearAllLocalData"
                                       Color="Color.Error"
                                       Variant="Variant.Filled"
                                       StartIcon="@Icons.Material.Filled.DeleteForever"
                                       Class="mt-2">
                                Clear All Local Data
                            </MudButton>
                        </MudAlert>
                    </MudItem>
                </MudGrid>
            </MudTabPanel>

            <!-- Version/Build Tab -->
            <MudTabPanel Text="About" Icon="@Icons.Material.Filled.Info">
                <MudText Typo="Typo.h5" Class="mb-2">Sorcha Blueprint Designer</MudText>
                <MudText Typo="Typo.body2" Color="Color.Secondary" Class="mb-4">
                    A visual designer for creating blockchain workflow blueprints
                </MudText>

                <MudDivider Class="my-4" />

                <MudGrid>
                    <MudItem xs="12" sm="6">
                        <MudPaper Class="pa-3" Outlined="true">
                            <MudText Typo="Typo.subtitle2" Class="mb-2">Version Information</MudText>
                            <MudText Typo="Typo.body2">
                                <strong>Version:</strong> 1.0.0-preview
                            </MudText>
                            <MudText Typo="Typo.body2">
                                <strong>Build:</strong> @buildNumber
                            </MudText>
                            <MudText Typo="Typo.body2">
                                <strong>Framework:</strong> .NET 10.0
                            </MudText>
                            <MudText Typo="Typo.body2">
                                <strong>Platform:</strong> Blazor WebAssembly
                            </MudText>
                        </MudPaper>
                    </MudItem>
                    <MudItem xs="12" sm="6">
                        <MudPaper Class="pa-3" Outlined="true">
                            <MudText Typo="Typo.subtitle2" Class="mb-2">Dependencies</MudText>
                            <MudText Typo="Typo.body2">
                                <strong>MudBlazor:</strong> 8.0.0
                            </MudText>
                            <MudText Typo="Typo.body2">
                                <strong>Blazor.Diagrams:</strong> Latest
                            </MudText>
                            <MudText Typo="Typo.body2">
                                <strong>Blazored.LocalStorage:</strong> Latest
                            </MudText>
                        </MudPaper>
                    </MudItem>
                </MudGrid>

                <MudDivider Class="my-4" />

                <MudText Typo="Typo.subtitle2" Class="mb-2">License</MudText>
                <MudText Typo="Typo.body2">
                    MIT License - Copyright (c) 2025 Sorcha Contributors
                </MudText>

                <MudDivider Class="my-4" />

                <MudText Typo="Typo.subtitle2" Class="mb-2">Links</MudText>
                <MudLink Href="https://github.com/sorcha/blueprint-designer" Target="_blank" Class="d-block mb-1">
                    <MudIcon Icon="@Icons.Custom.Brands.GitHub" Size="Size.Small" Class="mr-1" />
                    GitHub Repository
                </MudLink>
                <MudLink Href="https://sorcha.dev" Target="_blank" Class="d-block">
                    <MudIcon Icon="@Icons.Material.Filled.MenuBook" Size="Size.Small" Class="mr-1" />
                    Documentation
                </MudLink>
            </MudTabPanel>
        </MudTabs>
    </MudPaper>
</MudContainer>

@code {
    private List<SchemaProvider> schemaProviders = new();
    private string selectedTheme = "light";
    private bool showGrid = true;
    private bool snapToGrid = true;
    private string buildNumber = $"{DateTime.Now:yyyyMMdd}.{DateTime.Now:HHmm}";

    // Configuration state
    private AdminConfiguration? _config;
    private Dictionary<string, Profile> _profiles = new();
    private Profile? _activeProfile;

    // Storage state
    private bool _clearingCache;
    private int _pendingSyncCount;

    private const string SCHEMA_PROVIDERS_KEY = "sorcha:schemaProviders";
    private const string APPEARANCE_SETTINGS_KEY = "sorcha:appearanceSettings";

    protected override async Task OnInitializedAsync()
    {
        await LoadSchemaProviders();
        await LoadAppearanceSettings();
        await LoadConfiguration();
        await LoadSyncStatus();
    }

    private async Task LoadSyncStatus()
    {
        try
        {
            var items = await SyncService.GetQueuedItemsAsync();
            _pendingSyncCount = items.Count;
        }
        catch
        {
            _pendingSyncCount = 0;
        }
    }

    private async Task LoadSchemaProviders()
    {
        try
        {
            var json = await LocalStorage.GetItemAsStringAsync(SCHEMA_PROVIDERS_KEY);
            if (!string.IsNullOrEmpty(json))
            {
                schemaProviders = JsonSerializer.Deserialize<List<SchemaProvider>>(json) ?? new List<SchemaProvider>();
            }
            else
            {
                // Initialize with built-in providers
                schemaProviders = new List<SchemaProvider>
                {
                    new SchemaProvider
                    {
                        Id = "schema-org",
                        Name = "Schema.org",
                        Uri = "https://schema.org",
                        Description = "Structured data vocabularies for web content",
                        IsBuiltIn = true,
                        IsEnabled = true
                    },
                    new SchemaProvider
                    {
                        Id = "json-schema-org",
                        Name = "JSON Schema",
                        Uri = "https://json-schema.org",
                        Description = "JSON Schema specification and examples",
                        IsBuiltIn = true,
                        IsEnabled = true
                    }
                };
                await SaveSchemaProviders();
            }
        }
        catch (Exception ex)
        {
            Snackbar.Add($"Error loading schema providers: {ex.Message}", Severity.Error);
            schemaProviders = new List<SchemaProvider>();
        }
    }

    private async Task SaveSchemaProviders()
    {
        try
        {
            var json = JsonSerializer.Serialize(schemaProviders);
            await LocalStorage.SetItemAsStringAsync(SCHEMA_PROVIDERS_KEY, json);
            Snackbar.Add("Schema providers saved", Severity.Success);
        }
        catch (Exception ex)
        {
            Snackbar.Add($"Error saving schema providers: {ex.Message}", Severity.Error);
        }
    }

    private async Task DeleteProvider(string id)
    {
        var provider = schemaProviders.FirstOrDefault(p => p.Id == id);
        if (provider != null && !provider.IsBuiltIn)
        {
            schemaProviders.Remove(provider);
            await SaveSchemaProviders();
            Snackbar.Add($"Deleted provider: {provider.Name}", Severity.Info);
        }
    }

    private async Task OpenAddProviderDialog()
    {
        var parameters = new DialogParameters<AddSchemaProviderDialog>();
        var options = new DialogOptions { CloseButton = true, MaxWidth = MaxWidth.Small, FullWidth = true };
        var dialog = await DialogService.ShowAsync<AddSchemaProviderDialog>("Add Schema Provider", parameters, options);
        var result = await dialog.Result;

        if (result is not null && !result.Canceled && result.Data is SchemaProvider newProvider)
        {
            schemaProviders.Add(newProvider);
            await SaveSchemaProviders();
            Snackbar.Add($"Added provider: {newProvider.Name}", Severity.Success);
        }
    }

    private async Task LoadAppearanceSettings()
    {
        try
        {
            var json = await LocalStorage.GetItemAsStringAsync(APPEARANCE_SETTINGS_KEY);
            if (!string.IsNullOrEmpty(json))
            {
                var settings = JsonSerializer.Deserialize<Dictionary<string, object>>(json);
                if (settings != null)
                {
                    if (settings.ContainsKey("theme"))
                        selectedTheme = settings["theme"].ToString() ?? "light";
                    if (settings.ContainsKey("showGrid"))
                        showGrid = bool.Parse(settings["showGrid"].ToString() ?? "true");
                    if (settings.ContainsKey("snapToGrid"))
                        snapToGrid = bool.Parse(settings["snapToGrid"].ToString() ?? "true");
                }
            }
        }
        catch (Exception ex)
        {
            Snackbar.Add($"Error loading appearance settings: {ex.Message}", Severity.Error);
        }
    }

    private async Task SaveAppearanceSettings()
    {
        try
        {
            var settings = new Dictionary<string, object>
            {
                { "theme", selectedTheme },
                { "showGrid", showGrid },
                { "snapToGrid", snapToGrid }
            };
            var json = JsonSerializer.Serialize(settings);
            await LocalStorage.SetItemAsStringAsync(APPEARANCE_SETTINGS_KEY, json);
            Snackbar.Add("Appearance settings saved", Severity.Success);
        }
        catch (Exception ex)
        {
            Snackbar.Add($"Error saving appearance settings: {ex.Message}", Severity.Error);
        }
    }

    // Configuration methods
    private async Task LoadConfiguration()
    {
        try
        {
            _config = await ConfigService.GetConfigurationAsync();
            _profiles = _config.Profiles;
            _activeProfile = _config.GetActiveProfile();
            StateHasChanged();
        }
        catch (Exception ex)
        {
            Snackbar.Add($"Error loading configuration: {ex.Message}", Severity.Error);
        }
    }

    private async Task EditProfile(Profile profile)
    {
        var parameters = new DialogParameters<ProfileEditorDialog>
        {
            { x => x.Profile, profile },
            { x => x.IsNew, false }
        };

        var options = new DialogOptions { MaxWidth = MaxWidth.Medium, FullWidth = true };
        var dialog = await DialogService.ShowAsync<ProfileEditorDialog>("Edit Profile", parameters, options);
        var result = await dialog.Result;

        if (result is not null && !result.Canceled)
        {
            await LoadConfiguration();
            Snackbar.Add($"Profile '{profile.Name}' updated successfully", Severity.Success);
        }
    }

    private async Task CreateNewProfile()
    {
        var newProfile = new Profile
        {
            Name = "",
            VerifySsl = true,
            TimeoutSeconds = 30,
            DefaultClientId = "sorcha-admin"
        };

        var parameters = new DialogParameters<ProfileEditorDialog>
        {
            { x => x.Profile, newProfile },
            { x => x.IsNew, true }
        };

        var options = new DialogOptions { MaxWidth = MaxWidth.Medium, FullWidth = true };
        var dialog = await DialogService.ShowAsync<ProfileEditorDialog>("New Profile", parameters, options);
        var result = await dialog.Result;

        if (result is not null && !result.Canceled)
        {
            await LoadConfiguration();
            Snackbar.Add($"Profile '{newProfile.Name}' created successfully", Severity.Success);
        }
    }

    private async Task DeleteProfile(string profileName)
    {
        bool? confirmed = await DialogService.ShowMessageBox(
            "Confirm Delete",
            $"Are you sure you want to delete the profile '{profileName}'?",
            yesText: "Delete", cancelText: "Cancel");

        if (confirmed == true)
        {
            try
            {
                await ConfigService.DeleteProfileAsync(profileName);
                await LoadConfiguration();
                Snackbar.Add($"Profile '{profileName}' deleted", Severity.Info);
            }
            catch (InvalidOperationException ex)
            {
                Snackbar.Add($"Error: {ex.Message}", Severity.Error);
            }
            catch (Exception ex)
            {
                Snackbar.Add($"Error deleting profile: {ex.Message}", Severity.Error);
            }
        }
    }

    [Inject]
    private IDialogService DialogService { get; set; } = default!;

    private async Task ClearBlueprintCache()
    {
        bool? confirmed = await DialogService.ShowMessageBox(
            "Clear Blueprint Cache",
            "This will remove locally cached blueprints. Server data will remain intact. Continue?",
            yesText: "Clear", cancelText: "Cancel");

        if (confirmed == true)
        {
            _clearingCache = true;
            StateHasChanged();

            try
            {
                await BlueprintStorage.ClearLocalCacheAsync();
                Snackbar.Add("Blueprint cache cleared", Severity.Success);
            }
            catch (Exception ex)
            {
                Snackbar.Add($"Error clearing cache: {ex.Message}", Severity.Error);
            }
            finally
            {
                _clearingCache = false;
                StateHasChanged();
            }
        }
    }

    private async Task ClearSyncQueue()
    {
        bool? confirmed = await DialogService.ShowMessageBox(
            "Clear Sync Queue",
            "This will discard all pending offline changes. Are you sure?",
            yesText: "Clear", cancelText: "Cancel");

        if (confirmed == true)
        {
            try
            {
                await SyncService.ClearQueueAsync();
                _pendingSyncCount = 0;
                Snackbar.Add("Sync queue cleared", Severity.Success);
                StateHasChanged();
            }
            catch (Exception ex)
            {
                Snackbar.Add($"Error clearing sync queue: {ex.Message}", Severity.Error);
            }
        }
    }

    private async Task ClearAllLocalData()
    {
        bool? confirmed = await DialogService.ShowMessageBox(
            "Clear All Local Data",
            "This will reset ALL local settings, caches, and unsaved changes. This action cannot be undone. Are you absolutely sure?",
            yesText: "Yes, Clear Everything", cancelText: "Cancel");

        if (confirmed == true)
        {
            try
            {
                // Clear all local storage keys
                await LocalStorage.ClearAsync();

                Snackbar.Add("All local data cleared. Please refresh the page.", Severity.Success);

                // Redirect to home after clearing
                Navigation.NavigateTo("/", forceLoad: true);
            }
            catch (Exception ex)
            {
                Snackbar.Add($"Error clearing local data: {ex.Message}", Severity.Error);
            }
        }
    }
}
