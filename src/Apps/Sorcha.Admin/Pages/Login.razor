@page "/login"
@using Sorcha.Admin.Components.Authentication
@inject IDialogService DialogService
@inject NavigationManager Navigation

<PageTitle>Login - Sorcha Admin</PageTitle>

<AuthorizeView>
    <Authorized>
        @{
            // Already authenticated - redirect to home
            Navigation.NavigateTo("/", forceLoad: true);
        }
    </Authorized>
    <NotAuthorized>
        <div class="d-flex flex-column align-center justify-center" style="min-height: 100vh;">
            <MudPaper Elevation="4" Class="pa-8" Style="max-width: 500px; width: 100%;">
                <div class="d-flex flex-column align-center mb-6">
                    <MudIcon Icon="@Icons.Material.Filled.AdminPanelSettings" Size="Size.Large" Color="Color.Primary" Class="mb-4" Style="font-size: 4rem;" />
                    <MudText Typo="Typo.h4" Align="Align.Center" Class="mb-2">Sorcha Admin</MudText>
                    <MudText Typo="Typo.body2" Align="Align.Center" Color="Color.Secondary">
                        Blueprint Designer & Administration Portal
                    </MudText>
                </div>

                <MudButton Variant="Variant.Filled" Color="Color.Primary" FullWidth="true"
                           Size="Size.Large" StartIcon="@Icons.Material.Filled.Login"
                           OnClick="ShowLoginDialog">
                    Sign In
                </MudButton>

                <MudDivider Class="my-6" />

                <MudText Typo="Typo.caption" Align="Align.Center" Color="Color.Secondary">
                    Secure authentication powered by Sorcha Tenant Service
                </MudText>
            </MudPaper>
        </div>
    </NotAuthorized>
</AuthorizeView>

@code {
    protected override async Task OnInitializedAsync()
    {
        // Auto-show login dialog on page load
        await ShowLoginDialog();
    }

    private async Task ShowLoginDialog()
    {
        var options = new DialogOptions
        {
            MaxWidth = MaxWidth.Small,
            FullWidth = true,
            CloseButton = true,
            CloseOnEscapeKey = true
        };

        var dialog = await DialogService.ShowAsync<LoginDialog>("Login", options);
        var result = await dialog.Result;

        if (!result.Canceled)
        {
            // Login successful - navigate to home
            Navigation.NavigateTo("/", forceLoad: true);
        }
    }
}
