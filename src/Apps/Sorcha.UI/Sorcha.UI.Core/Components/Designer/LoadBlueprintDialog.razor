@using Sorcha.Blueprint.Models
@using System.Text.Json

<MudDialog>
    <TitleContent>
        <div class="d-flex align-center justify-space-between" style="width: 100%;">
            <MudText Typo="Typo.h6">
                <MudIcon Icon="@Icons.Material.Filled.FolderOpen" Class="mr-2" />
                Load Blueprint
            </MudText>
            <div>
                <MudIconButton Icon="@Icons.Material.Filled.Close"
                               Color="Color.Default"
                               Size="Size.Small"
                               OnClick="Cancel"
                               Title="Close" />
            </div>
        </div>
    </TitleContent>
    <DialogContent>
        <MudText Typo="Typo.body2" Color="Color.Secondary" Class="mb-4">
            Select a blueprint to load into the designer
        </MudText>

        @if (Blueprints != null && Blueprints.Any())
        {
            <MudList T="string" Clickable="true" @bind-SelectedValue="selectedBlueprintId">
                @foreach (var blueprint in Blueprints)
                {
                    <MudListItem Value="@blueprint.Id" OnClick="@(() => SelectBlueprint(blueprint.Id))">
                        <div class="d-flex flex-column pa-2">
                            <div class="d-flex align-center justify-space-between mb-2">
                                <MudText Typo="Typo.h6">@blueprint.Title</MudText>
                                <MudChip T="string" Size="Size.Small" Color="Color.Info">v@blueprint.Version</MudChip>
                            </div>
                            <MudText Typo="Typo.body2" Color="Color.Secondary" Class="mb-2">
                                @blueprint.Description
                            </MudText>
                            <div class="d-flex gap-3 flex-wrap">
                                <MudChip T="string" Size="Size.Small" Icon="@Icons.Material.Filled.People" Color="Color.Default">
                                    @blueprint.Participants.Count Participants
                                </MudChip>
                                <MudChip T="string" Size="Size.Small" Icon="@Icons.Material.Filled.PlayArrow" Color="Color.Default">
                                    @blueprint.Actions.Count Actions
                                </MudChip>
                                <MudChip T="string" Size="Size.Small" Icon="@Icons.Material.Filled.CalendarToday" Color="Color.Default">
                                    Updated: @blueprint.UpdatedAt.ToString("MMM d, yyyy")
                                </MudChip>
                            </div>
                        </div>
                    </MudListItem>
                    <MudDivider />
                }
            </MudList>
        }
        else
        {
            <MudAlert Severity="Severity.Info" Class="mb-3">
                No blueprints available. Create your first blueprint to get started!
            </MudAlert>
        }
    </DialogContent>
    <DialogActions>
        <MudButton OnClick="Cancel" Color="Color.Default">Cancel</MudButton>
        <MudButton OnClick="Load"
                   Color="Color.Primary"
                   Variant="Variant.Filled"
                   Disabled="@(selectedBlueprintId == null || string.IsNullOrEmpty(selectedBlueprintId))">
            Load
        </MudButton>
    </DialogActions>
</MudDialog>

@code {
    [CascadingParameter]
    MudBlazor.IDialogReference? MudDialog { get; set; }

    [Parameter]
    public List<Blueprint> Blueprints { get; set; } = new();

    private string? selectedBlueprintId;

    private void SelectBlueprint(string blueprintId)
    {
        selectedBlueprintId = blueprintId;
    }

    private void Load()
    {
        if (selectedBlueprintId != null)
        {
            MudDialog?.Close(DialogResult.Ok(selectedBlueprintId));
        }
    }

    private void Cancel()
    {
        MudDialog?.Close();
    }
}
