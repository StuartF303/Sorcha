@* SPDX-License-Identifier: MIT *@
@* Copyright (c) 2026 Sorcha Contributors *@

@using MudBlazor
@inject IJSRuntime JS
@inject ISnackbar Snackbar

@if (string.IsNullOrEmpty(Value))
{
    <MudText Typo="Typo.body2" Class="mud-text-secondary">â€”</MudText>
}
else if (Value.Length <= MaxLength)
{
    <MudText Typo="Typo.body2" Class="@Class" Style="@($"font-family: monospace; {Style}")">@Value</MudText>
}
else
{
    <MudTooltip Text="@Value" Arrow="true" Placement="Placement.Top">
        <MudText Typo="Typo.body2"
                 Class="@($"truncated-id {Class}")"
                 Style="@($"font-family: monospace; cursor: pointer; {Style}")"
                 @onclick="CopyToClipboard">@Truncate(Value)</MudText>
    </MudTooltip>
}

@code {
    [Parameter]
    public string? Value { get; set; }

    [Parameter]
    public int MaxLength { get; set; } = 12;

    [Parameter]
    public string? Class { get; set; }

    [Parameter]
    public string? Style { get; set; }

    private string Truncate(string value)
    {
        if (value.Length <= MaxLength) return value;

        var prefix = value.StartsWith("0x", StringComparison.OrdinalIgnoreCase) ? "0x" : "";
        var start = prefix.Length > 0 ? value[..(prefix.Length + 6)] : value[..6];
        var end = value[^6..];
        return $"{start}...{end}";
    }

    private async Task CopyToClipboard()
    {
        if (string.IsNullOrEmpty(Value)) return;

        try
        {
            await JS.InvokeVoidAsync("navigator.clipboard.writeText", Value);
            Snackbar.Add("Copied to clipboard", Severity.Success, config =>
            {
                config.VisibleStateDuration = 1500;
                config.ShowTransitionDuration = 200;
                config.HideTransitionDuration = 200;
            });
        }
        catch
        {
            Snackbar.Add("Failed to copy", Severity.Error);
        }
    }
}
