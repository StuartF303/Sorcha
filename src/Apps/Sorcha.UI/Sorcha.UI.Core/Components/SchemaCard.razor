@* SPDX-License-Identifier: MIT *@
@* Copyright (c) 2026 Sorcha Contributors *@

@using Sorcha.UI.Core.Models.SchemaLibrary

<MudCard Elevation="1" Class="schema-card" Style="height: 100%;">
    <MudCardContent>
        <MudStack Spacing="1">
            <MudStack Row="true" AlignItems="AlignItems.Start" Justify="Justify.SpaceBetween">
                <MudText Typo="Typo.subtitle1" Style="font-weight: 600;">@Entry.Title</MudText>
                <MudChip T="string"
                         Size="MudBlazor.Size.Small"
                         Color="@GetProviderColor(Entry.SourceProvider)"
                         Variant="Variant.Outlined">
                    @Entry.SourceProvider
                </MudChip>
            </MudStack>

            @if (!string.IsNullOrWhiteSpace(Entry.Description))
            {
                <MudText Typo="Typo.body2" Class="mud-text-secondary" Style="overflow: hidden; text-overflow: ellipsis; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical;">
                    @Entry.Description
                </MudText>
            }

            <MudStack Row="true" Spacing="1" Class="flex-wrap mt-1">
                @foreach (var sector in Entry.SectorTags.Take(3))
                {
                    <MudChip T="string" Size="MudBlazor.Size.Small" Variant="Variant.Text" Color="Color.Info">
                        @sector
                    </MudChip>
                }
                @if (Entry.SectorTags.Length > 3)
                {
                    <MudChip T="string" Size="MudBlazor.Size.Small" Variant="Variant.Text" Color="Color.Default">
                        +@(Entry.SectorTags.Length - 3)
                    </MudChip>
                }
            </MudStack>

            <MudStack Row="true" Spacing="2" AlignItems="AlignItems.Center" Class="mt-1">
                <MudStack Row="true" Spacing="1" AlignItems="AlignItems.Center">
                    <MudIcon Icon="@Icons.Material.Filled.ListAlt" Size="MudBlazor.Size.Small" Color="Color.Default" />
                    <MudText Typo="Typo.caption">@Entry.FieldCount fields</MudText>
                </MudStack>
                @if (Entry.RequiredFieldCount > 0)
                {
                    <MudStack Row="true" Spacing="1" AlignItems="AlignItems.Center">
                        <MudIcon Icon="@Icons.Material.Filled.Star" Size="MudBlazor.Size.Small" Color="Color.Warning" />
                        <MudText Typo="Typo.caption">@Entry.RequiredFieldCount required</MudText>
                    </MudStack>
                }
                @if (!string.IsNullOrWhiteSpace(Entry.SchemaVersion))
                {
                    <MudText Typo="Typo.caption" Class="mud-text-secondary">v@(Entry.SchemaVersion)</MudText>
                }
            </MudStack>
        </MudStack>
    </MudCardContent>
    <MudCardActions>
        <MudButton Size="MudBlazor.Size.Small"
                   Variant="Variant.Text"
                   Color="Color.Primary"
                   StartIcon="@Icons.Material.Filled.Visibility"
                   OnClick="@(() => OnViewDetail.InvokeAsync(Entry))">
            View Details
        </MudButton>
    </MudCardActions>
</MudCard>

@code {
    [Parameter, EditorRequired] public SchemaIndexEntryViewModel Entry { get; set; } = default!;
    [Parameter] public EventCallback<SchemaIndexEntryViewModel> OnViewDetail { get; set; }

    private static Color GetProviderColor(string provider)
    {
        return provider.ToLowerInvariant() switch
        {
            "schemastore" => Color.Info,
            "schema.org" => Color.Success,
            "fhir" or "hl7-fhir" => Color.Error,
            "w3c-vc" => Color.Secondary,
            "ubl" => Color.Warning,
            "niem" => Color.Tertiary,
            _ => Color.Default
        };
    }
}
