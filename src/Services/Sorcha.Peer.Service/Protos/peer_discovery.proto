// SPDX-License-Identifier: MIT
// Copyright (c) 2025 Sorcha Contributors

syntax = "proto3";

package sorcha.peer.discovery;

option csharp_namespace = "Sorcha.Peer.Service.Protos";

// Peer Discovery Service
// Enables peers to find and connect to each other in the network
service PeerDiscovery {
  // Get list of known peers from this peer
  rpc GetPeerList(PeerListRequest) returns (PeerListResponse);

  // Register as a new peer in the network
  rpc RegisterPeer(RegisterPeerRequest) returns (RegisterPeerResponse);

  // Health check - ping a peer to verify it's online
  rpc Ping(PingRequest) returns (PingResponse);
}

// Request for peer list
message PeerListRequest {
  string requesting_peer_id = 1;
  int32 max_peers = 2;
}

// Response with peer list
message PeerListResponse {
  repeated PeerInfo peers = 1;
  int32 total_peers = 2;
}

// Information about a peer node
message PeerInfo {
  string peer_id = 1;
  string address = 2;
  int32 port = 3;
  repeated string supported_protocols = 4;
  int64 last_seen = 5;
  PeerCapabilities capabilities = 6;
}

// Capabilities of a peer
message PeerCapabilities {
  bool supports_streaming = 1;
  bool supports_transaction_distribution = 2;
  int32 max_transaction_size = 3;
}

// Request to register as a peer
message RegisterPeerRequest {
  PeerInfo peer_info = 1;
}

// Response to registration request
message RegisterPeerResponse {
  bool success = 1;
  string message = 2;
}

// Ping request for health check
message PingRequest {
  string peer_id = 1;
}

// Ping response
message PingResponse {
  string peer_id = 1;
  int64 timestamp = 2;
  PeerStatus status = 3;
}

// Status of a peer
enum PeerStatus {
  UNKNOWN = 0;
  ONLINE = 1;
  OFFLINE = 2;
  BUSY = 3;
}
