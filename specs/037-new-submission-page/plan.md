# Implementation Plan: New Submission Page

**Branch**: `037-new-submission-page` | **Date**: 2026-02-18 | **Spec**: [spec.md](spec.md)
**Input**: Feature specification from `/specs/037-new-submission-page/spec.md`

## Summary

Redesign the "New Submission" page from a workflow instance list into a service directory where users browse available blueprints grouped by register (authority/jurisdiction) and start new submissions. The form rendering pipeline from branch 032 is reused. Fix the broken action submission flow in "Pending Actions" (wallet not wired, submission not sent). Swap navigation order to reflect natural workflow lifecycle.

**No backend changes required** — all work is in the Blazor WASM UI layer, using existing API endpoints.

## Technical Context

**Language/Version**: C# 13 / .NET 10
**Primary Dependencies**: MudBlazor 8.15.0, Blazored.LocalStorage 4.5.0, Sorcha.UI.Core (form renderer, service clients)
**Storage**: Browser localStorage (wallet preference only)
**Testing**: xUnit + FluentAssertions + Moq (UI.Core.Tests)
**Target Platform**: Blazor WASM (browser)
**Project Type**: Web application (existing Blazor WASM client)
**Performance Goals**: Page load < 3 seconds, form submission < 30 seconds
**Constraints**: No backend API changes. Reuse existing form renderer components. WASM bundle size awareness.
**Scale/Scope**: 3 new components, 2 page rewrites, 1 new service, ~6 modified service files

## Constitution Check

*GATE: Must pass before Phase 0 research. Re-check after Phase 1 design.*

| Gate | Status | Notes |
|------|--------|-------|
| I. Microservices-First | PASS | No backend changes. UI is independently deployable. |
| II. Security First | PASS | Wallet signing uses existing pre-hashed flow. JWT auth maintained. No secrets in localStorage (only wallet address preference). |
| III. API Documentation | N/A | No new endpoints. UI-only changes. |
| IV. Testing Requirements | PASS | Unit tests for WalletPreferenceService. Component tests for new dialog. |
| V. Code Quality | PASS | Follows existing Blazor patterns. Nullable enabled. |
| VI. Blueprint Standards | PASS | Blueprints consumed as JSON — no creation changes. |
| VII. Domain-Driven Design | PASS | Uses correct terminology: Blueprint, Action, Participant, Disclosure. |
| VIII. Observability | PASS | Structured logging for submission flow. |

**Post-design re-check**: All gates still pass. No violations.

## Project Structure

### Documentation (this feature)

```text
specs/037-new-submission-page/
├── plan.md              # This file
├── spec.md              # Feature specification
├── research.md          # Phase 0 research findings
├── data-model.md        # Entity models and data flow
├── quickstart.md        # Build, test, and verification guide
├── contracts/
│   └── ui-service-contracts.md  # New/updated UI service methods
└── tasks.md             # Task list (generated by /speckit.tasks)
```

### Source Code (repository root)

```text
src/Apps/Sorcha.UI/
├── Sorcha.UI.Core/
│   ├── Components/
│   │   └── Workflows/
│   │       ├── ActionForm.razor           # FIX: wire wallet address
│   │       ├── NewSubmissionDialog.razor   # NEW: start blueprint dialog
│   │       └── WalletSelector.razor        # NEW: inline wallet picker
│   ├── Extensions/
│   │   └── ServiceCollectionExtensions.cs  # MOD: register new services
│   ├── Models/
│   │   └── Workflows/
│   │       ├── AvailableBlueprintsViewModel.cs     # NEW
│   │       ├── StartableBlueprintViewModel.cs      # NEW
│   │       ├── RegisterBlueprintGroup.cs            # NEW
│   │       └── ActionSubmissionResultViewModel.cs   # NEW
│   └── Services/
│       ├── IBlueprintApiService.cs         # MOD: add GetAvailableBlueprintsAsync
│       ├── BlueprintApiService.cs          # MOD: implement new method
│       ├── IWorkflowService.cs             # MOD: add CreateInstanceAsync, fix SubmitActionAsync
│       ├── WorkflowService.cs              # MOD: implement new/updated methods
│       ├── IWalletPreferenceService.cs     # NEW
│       └── WalletPreferenceService.cs      # NEW
└── Sorcha.UI.Web.Client/
    ├── Components/
    │   └── Layout/
    │       └── MainLayout.razor            # MOD: swap nav order
    └── Pages/
        ├── MyWorkflows.razor               # REWRITE: service directory
        └── MyActions.razor                 # FIX: wire submission flow

tests/Sorcha.UI.Core.Tests/
└── Services/
    └── WalletPreferenceServiceTests.cs     # NEW
```

**Structure Decision**: All changes within existing Blazor WASM project structure. No new projects. New files follow existing folder conventions (`Components/Workflows/`, `Models/Workflows/`, `Services/`).

## Complexity Tracking

No constitution violations. No complexity justification needed.
