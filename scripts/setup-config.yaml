# SPDX-License-Identifier: MIT
# Copyright (c) 2026 Sorcha Contributors

# Sorcha Platform Setup Configuration Template
# Copy this file to setup-config.local.yaml and customize for your environment
# Run: ./scripts/setup.ps1 or ./scripts/setup.sh

# Installation Identity
# Used for JWT issuer/audience and service discovery
installation:
  name: "localhost"
  environment: "development"  # development | staging | production

# Docker Configuration
docker:
  # Compose file to use (relative to project root)
  composeFile: "docker-compose.yml"
  # Project name prefix for containers and volumes
  projectName: "sorcha"
  # Pull images before starting (for production)
  pullImages: false
  # Build images locally
  buildImages: true

# Port Configuration
# Override default ports if there are conflicts
ports:
  # Infrastructure
  redis: 16379
  postgres: 5432
  mongodb: 27017
  aspireDashboard: 18888

  # Application Services
  blueprintService: 5000
  registerService: 5380
  tenantService: 5450
  validatorService: 5800
  peerServiceGrpc: 50051

  # UI and Gateway
  apiGatewayHttp: 80
  apiGatewayHttps: 443
  uiWeb: 5400

# Database Configuration
databases:
  postgres:
    user: "sorcha"
    password: "sorcha_dev_password"  # CHANGE FOR PRODUCTION
    databases:
      - "sorcha"
      - "sorcha_tenant"
      - "sorcha_wallet"

  mongodb:
    user: "sorcha"
    password: "sorcha_dev_password"  # CHANGE FOR PRODUCTION
    databases:
      - "sorcha_register"
      - "sorcha_system_register"

  redis:
    password: ""  # Empty for development
    # password: "your_redis_password"  # For production

# Security Configuration
security:
  jwt:
    # Signing key will be auto-generated if not provided
    # signingKey: "base64-encoded-256-bit-key"
    issuer: "https://tenant.sorcha.local"
    audience: "sorcha-services"
    tokenExpiration: "1h"
    refreshTokenExpiration: "7d"

  https:
    # Enable HTTPS (requires certificate)
    enabled: false
    # Certificate file path (relative to project root)
    certificatePath: "docker/certs/aspnetapp.pfx"
    certificatePassword: "SorchaDev2025"

# Initial Bootstrap Configuration
# Used by bootstrap script to create initial organization
bootstrap:
  # Organization to create
  organization:
    name: "Default Organization"
    subdomain: "default"

  # Administrator account
  admin:
    email: "admin@sorcha.local"
    displayName: "Administrator"
    # Password will be prompted if not provided
    # password: "secure_password_here"

  # Service principal for automation
  servicePrincipal:
    create: true
    name: "bootstrap-principal"

# Observability Configuration
observability:
  # OpenTelemetry
  otlp:
    endpoint: "http://aspire-dashboard:18889"
    exportInterval: "10s"

  # Logging
  logging:
    level: "Information"  # Trace | Debug | Information | Warning | Error | Critical
    structured: true

# Feature Flags
features:
  # Enable SignalR for real-time notifications
  signalr: true
  # Enable gRPC for peer communication
  grpc: true
  # Enable metrics endpoints
  metrics: true
  # Enable Scalar API documentation
  scalarDocs: true

# Volume Configuration
volumes:
  # Data persistence
  redisData: "sorcha_redis-data"
  postgresData: "sorcha_postgres-data"
  mongodbData: "sorcha_mongodb-data"

  # Security
  dataprotectionKeys: "sorcha_dataprotection-keys"
  walletEncryptionKeys: "sorcha_wallet-encryption-keys"

# Health Check Configuration
healthChecks:
  # Interval between health checks
  interval: "10s"
  # Timeout for health check requests
  timeout: "5s"
  # Number of retries before marking unhealthy
  retries: 3

# Setup Script Options
setup:
  # Skip Docker checks (for CI/CD)
  skipDocker: false
  # Skip infrastructure startup
  skipInfrastructure: false
  # Force re-initialization
  force: false
  # Verbose output
  verbose: false
