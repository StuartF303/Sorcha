{
  "id": "medical-equipment-refurb-v1",
  "title": "Medical Equipment Refurbishment",
  "description": "Multi-org healthcare workflow for medical device refurbishment. A hospital submits a defective device, a biomedical engineer assesses it, the department head approves the budget, the refurbishment company quotes and performs the work, and a health authority compliance officer certifies safety-critical devices before return to service.",
  "version": 1,
  "category": "healthcare",
  "tags": ["healthcare", "medical-device", "refurbishment", "multi-org", "conditional-routing", "calculations", "verifiable-credential", "rejection", "participant-publishing"],
  "author": "Sorcha Team",
  "published": true,
  "template": {
    "id": "medical-equipment-refurb-generated",
    "title": "Medical Equipment Refurbishment",
    "description": "A realistic medical equipment refurbishment process involving three organisations and four participants. Features conditional routing based on risk category, JSON Logic calculations, rejection paths, and Refurbishment Certificate Verifiable Credential issuance.",
    "version": 1,
    "metadata": {
      "category": "Healthcare",
      "complexity": "Complex",
      "actions": "5",
      "features": "Multi-Org, Conditional Routing, Calculations, Rejection, Verifiable Credential, Participant Publishing",
      "sector": "Healthcare & Medical Devices"
    },
    "participants": [
      {
        "id": "biomedical-engineer",
        "name": "Biomedical Engineer",
        "organisation": "City General Hospital",
        "description": "Submits defective device for refurbishment and performs initial assessment"
      },
      {
        "id": "department-head",
        "name": "Department Head",
        "organisation": "City General Hospital",
        "description": "Approves the refurbishment request and authorises budget expenditure"
      },
      {
        "id": "lead-technician",
        "name": "Lead Technician",
        "organisation": "MedTech Refurbishment Ltd",
        "description": "Quotes, accepts, and performs the refurbishment work"
      },
      {
        "id": "compliance-officer",
        "name": "Compliance Officer",
        "organisation": "Regional Health Authority",
        "description": "Final regulatory compliance check and certification for safety-critical devices"
      }
    ],
    "actions": [
      {
        "id": 1,
        "title": "Submit Refurbishment Request",
        "description": "Biomedical engineer submits a defective medical device for refurbishment, including device details, failure description, and risk classification",
        "sender": "biomedical-engineer",
        "isStartingAction": true,
        "dataSchemas": [
          {
            "type": "object",
            "properties": {
              "deviceName": {
                "type": "string",
                "title": "Device Name",
                "minLength": 3,
                "maxLength": 200
              },
              "deviceClass": {
                "type": "string",
                "title": "Device Classification",
                "enum": ["Class I", "Class IIa", "Class IIb", "Class III"]
              },
              "manufacturer": {
                "type": "string",
                "title": "Manufacturer",
                "minLength": 2,
                "maxLength": 200
              },
              "serialNumber": {
                "type": "string",
                "title": "Serial Number",
                "minLength": 3,
                "maxLength": 50
              },
              "failureType": {
                "type": "string",
                "title": "Failure Type",
                "enum": ["electrical", "mechanical", "software", "calibration", "safety", "cosmetic"]
              },
              "failureDescription": {
                "type": "string",
                "title": "Failure Description",
                "maxLength": 2000
              },
              "department": {
                "type": "string",
                "title": "Originating Department",
                "minLength": 2,
                "maxLength": 100
              },
              "complexityFactor": {
                "type": "number",
                "title": "Complexity Factor (1-10)",
                "minimum": 1,
                "maximum": 10
              },
              "urgency": {
                "type": "string",
                "title": "Urgency",
                "enum": ["routine", "urgent", "critical"]
              }
            },
            "required": [
              "deviceName",
              "deviceClass",
              "manufacturer",
              "serialNumber",
              "failureType",
              "failureDescription",
              "department",
              "complexityFactor",
              "urgency"
            ]
          }
        ],
        "disclosures": [
          {
            "participantAddress": "biomedical-engineer",
            "dataPointers": ["/*"]
          },
          {
            "participantAddress": "department-head",
            "dataPointers": [
              "/deviceName",
              "/deviceClass",
              "/manufacturer",
              "/failureType",
              "/department",
              "/urgency"
            ]
          }
        ],
        "routes": [
          {
            "id": "to-approval",
            "nextActionIds": [2],
            "isDefault": true,
            "description": "Route to departmental approval"
          }
        ],
        "form": {
          "type": "Layout",
          "layout": "VerticalLayout",
          "title": "Refurbishment Request",
          "elements": [
            {
              "type": "Layout",
              "layout": "Group",
              "title": "Device Information",
              "elements": [
                {
                  "type": "TextLine",
                  "scope": "/deviceName",
                  "title": "Device Name"
                },
                {
                  "type": "Layout",
                  "layout": "HorizontalLayout",
                  "elements": [
                    {
                      "type": "Selection",
                      "scope": "/deviceClass",
                      "title": "Device Classification"
                    },
                    {
                      "type": "TextLine",
                      "scope": "/manufacturer",
                      "title": "Manufacturer"
                    }
                  ]
                },
                {
                  "type": "TextLine",
                  "scope": "/serialNumber",
                  "title": "Serial Number"
                }
              ]
            },
            {
              "type": "Layout",
              "layout": "Group",
              "title": "Failure Details",
              "elements": [
                {
                  "type": "Layout",
                  "layout": "HorizontalLayout",
                  "elements": [
                    {
                      "type": "Selection",
                      "scope": "/failureType",
                      "title": "Failure Type"
                    },
                    {
                      "type": "Selection",
                      "scope": "/urgency",
                      "title": "Urgency"
                    }
                  ]
                },
                {
                  "type": "TextArea",
                  "scope": "/failureDescription",
                  "title": "Failure Description"
                }
              ]
            },
            {
              "type": "Layout",
              "layout": "HorizontalLayout",
              "elements": [
                {
                  "type": "TextLine",
                  "scope": "/department",
                  "title": "Originating Department"
                },
                {
                  "type": "Numeric",
                  "scope": "/complexityFactor",
                  "title": "Complexity Factor (1-10)"
                }
              ]
            }
          ]
        }
      },
      {
        "id": 2,
        "title": "Departmental Approval",
        "description": "Department head reviews the refurbishment request, checks budget availability, and approves or rejects the expenditure",
        "sender": "department-head",
        "requiredPriorActions": [1],
        "dataSchemas": [
          {
            "type": "object",
            "properties": {
              "budgetApproved": {
                "type": "boolean",
                "title": "Budget Approved"
              },
              "budgetCode": {
                "type": "string",
                "title": "Budget Code",
                "pattern": "^[A-Z]{2,4}-\\d{4,8}$",
                "maxLength": 20
              },
              "approvalNotes": {
                "type": "string",
                "title": "Approval Notes",
                "maxLength": 2000
              }
            },
            "required": [
              "budgetApproved",
              "budgetCode",
              "approvalNotes"
            ]
          }
        ],
        "rejectionConfig": {
          "targetActionId": 1,
          "requireReason": true,
          "isTerminal": false
        },
        "disclosures": [
          {
            "participantAddress": "department-head",
            "dataPointers": ["/*"]
          },
          {
            "participantAddress": "lead-technician",
            "dataPointers": [
              "/deviceName",
              "/deviceClass",
              "/manufacturer",
              "/serialNumber",
              "/failureType",
              "/failureDescription",
              "/complexityFactor",
              "/urgency"
            ]
          }
        ],
        "routes": [
          {
            "id": "to-quote",
            "nextActionIds": [3],
            "isDefault": true,
            "description": "Route to refurbishment quote"
          }
        ],
        "form": {
          "type": "Layout",
          "layout": "VerticalLayout",
          "title": "Departmental Approval",
          "elements": [
            {
              "type": "Checkbox",
              "scope": "/budgetApproved",
              "title": "Budget approved for this refurbishment"
            },
            {
              "type": "TextLine",
              "scope": "/budgetCode",
              "title": "Budget Code (e.g. MED-20260001)"
            },
            {
              "type": "TextArea",
              "scope": "/approvalNotes",
              "title": "Approval Notes"
            }
          ]
        }
      },
      {
        "id": 3,
        "title": "Quote & Accept Job",
        "description": "Lead technician reviews device details, calculates risk category and estimated cost, provides a quote, and accepts the job. Safety-critical devices are routed to regulatory review; routine devices proceed directly to completion.",
        "sender": "lead-technician",
        "requiredPriorActions": [1, 2],
        "dataSchemas": [
          {
            "type": "object",
            "properties": {
              "initialAssessment": {
                "type": "string",
                "title": "Initial Technical Assessment",
                "maxLength": 2000
              },
              "partsRequired": {
                "type": "string",
                "title": "Parts Required",
                "maxLength": 1000
              },
              "estimatedDays": {
                "type": "integer",
                "title": "Estimated Working Days",
                "minimum": 1,
                "maximum": 90
              },
              "jobAccepted": {
                "type": "boolean",
                "title": "Job Accepted"
              }
            },
            "required": [
              "initialAssessment",
              "partsRequired",
              "estimatedDays",
              "jobAccepted"
            ]
          }
        ],
        "calculations": {
          "riskCategory": {
            "if": [
              {
                "or": [
                  { "==": [{ "var": "deviceClass" }, "Class III"] },
                  {
                    "and": [
                      {
                        "in": [{ "var": "deviceClass" }, ["Class IIa", "Class IIb"]]
                      },
                      { "==": [{ "var": "failureType" }, "safety"] }
                    ]
                  }
                ]
              },
              "safety-critical",
              "routine"
            ]
          },
          "estimatedCost": {
            "max": [
              500,
              {
                "*": [
                  {
                    "if": [
                      { "==": [{ "var": "deviceClass" }, "Class III"] }, 4,
                      { "==": [{ "var": "deviceClass" }, "Class IIb"] }, 3,
                      { "==": [{ "var": "deviceClass" }, "Class IIa"] }, 2,
                      1
                    ]
                  },
                  { "var": "complexityFactor" },
                  250
                ]
              }
            ]
          }
        },
        "rejectionConfig": {
          "targetActionId": 1,
          "requireReason": true,
          "isTerminal": false
        },
        "disclosures": [
          {
            "participantAddress": "lead-technician",
            "dataPointers": ["/*"]
          },
          {
            "participantAddress": "compliance-officer",
            "dataPointers": [
              "/deviceName",
              "/deviceClass",
              "/manufacturer",
              "/serialNumber",
              "/failureType",
              "/failureDescription",
              "/riskCategory",
              "/initialAssessment",
              "/partsRequired"
            ]
          },
          {
            "participantAddress": "biomedical-engineer",
            "dataPointers": [
              "/deviceName",
              "/riskCategory",
              "/estimatedCost",
              "/estimatedDays",
              "/initialAssessment",
              "/jobAccepted"
            ]
          }
        ],
        "routes": [
          {
            "id": "safety-critical",
            "nextActionIds": [4],
            "condition": { "==": [{ "var": "riskCategory" }, "safety-critical"] },
            "description": "Safety-critical device: route to regulatory hold and compliance review"
          },
          {
            "id": "routine",
            "nextActionIds": [5],
            "isDefault": true,
            "description": "Routine device: skip regulatory review, proceed to completion"
          }
        ],
        "form": {
          "type": "Layout",
          "layout": "VerticalLayout",
          "title": "Quote & Accept Job",
          "elements": [
            {
              "type": "Layout",
              "layout": "Group",
              "title": "Technical Assessment",
              "elements": [
                {
                  "type": "TextArea",
                  "scope": "/initialAssessment",
                  "title": "Initial Technical Assessment"
                },
                {
                  "type": "TextArea",
                  "scope": "/partsRequired",
                  "title": "Parts Required"
                }
              ]
            },
            {
              "type": "Layout",
              "layout": "HorizontalLayout",
              "elements": [
                {
                  "type": "Numeric",
                  "scope": "/estimatedDays",
                  "title": "Estimated Working Days"
                },
                {
                  "type": "Checkbox",
                  "scope": "/jobAccepted",
                  "title": "Job accepted and work will commence"
                }
              ]
            }
          ]
        }
      },
      {
        "id": 4,
        "title": "Regulatory Hold & Review",
        "description": "Compliance officer performs regulatory review for safety-critical devices. This action is only reached via conditional routing when the risk category is safety-critical. The officer may reject if the device cannot be safely refurbished.",
        "sender": "compliance-officer",
        "requiredPriorActions": [1, 2, 3],
        "dataSchemas": [
          {
            "type": "object",
            "properties": {
              "regulatoryStandard": {
                "type": "string",
                "title": "Applicable Regulatory Standard",
                "enum": ["IEC 62353", "IEC 60601", "ISO 13485", "MDR 2017/745"]
              },
              "complianceStatus": {
                "type": "string",
                "title": "Compliance Status",
                "enum": ["compliant", "conditionally-compliant", "non-compliant"]
              },
              "regulatoryConditions": {
                "type": "string",
                "title": "Regulatory Conditions",
                "maxLength": 2000
              },
              "reinspectionRequired": {
                "type": "boolean",
                "title": "Post-Refurbishment Reinspection Required"
              }
            },
            "required": [
              "regulatoryStandard",
              "complianceStatus",
              "regulatoryConditions",
              "reinspectionRequired"
            ]
          }
        ],
        "rejectionConfig": {
          "targetActionId": 1,
          "requireReason": true,
          "isTerminal": false
        },
        "disclosures": [
          {
            "participantAddress": "compliance-officer",
            "dataPointers": ["/*"]
          },
          {
            "participantAddress": "lead-technician",
            "dataPointers": [
              "/regulatoryStandard",
              "/complianceStatus",
              "/regulatoryConditions",
              "/reinspectionRequired"
            ]
          }
        ],
        "routes": [
          {
            "id": "to-completion",
            "nextActionIds": [5],
            "isDefault": true,
            "description": "Route to refurbishment completion and certification"
          }
        ],
        "form": {
          "type": "Layout",
          "layout": "VerticalLayout",
          "title": "Regulatory Hold & Review",
          "elements": [
            {
              "type": "Layout",
              "layout": "HorizontalLayout",
              "elements": [
                {
                  "type": "Selection",
                  "scope": "/regulatoryStandard",
                  "title": "Applicable Standard"
                },
                {
                  "type": "Selection",
                  "scope": "/complianceStatus",
                  "title": "Compliance Status"
                }
              ]
            },
            {
              "type": "TextArea",
              "scope": "/regulatoryConditions",
              "title": "Regulatory Conditions and Requirements"
            },
            {
              "type": "Checkbox",
              "scope": "/reinspectionRequired",
              "title": "Post-refurbishment reinspection is required before return to service"
            }
          ]
        }
      },
      {
        "id": 5,
        "title": "Complete & Certify",
        "description": "Lead technician completes the refurbishment work and issues a Refurbishment Certificate Verifiable Credential to the biomedical engineer, confirming the device is safe to return to service.",
        "sender": "lead-technician",
        "requiredPriorActions": [1, 2, 3],
        "dataSchemas": [
          {
            "type": "object",
            "properties": {
              "workPerformed": {
                "type": "string",
                "title": "Work Performed",
                "maxLength": 2000
              },
              "partsReplaced": {
                "type": "string",
                "title": "Parts Replaced",
                "maxLength": 1000
              },
              "testResults": {
                "type": "string",
                "title": "Post-Refurbishment Test Results",
                "maxLength": 2000
              },
              "safetyTestPassed": {
                "type": "boolean",
                "title": "Safety Test Passed"
              },
              "certificateNumber": {
                "type": "string",
                "title": "Refurbishment Certificate Number",
                "pattern": "^RC-\\d{4}-\\d{5}$",
                "maxLength": 15
              },
              "returnToServiceDate": {
                "type": "string",
                "format": "date",
                "title": "Return to Service Date"
              }
            },
            "required": [
              "workPerformed",
              "partsReplaced",
              "testResults",
              "safetyTestPassed",
              "certificateNumber",
              "returnToServiceDate"
            ]
          }
        ],
        "credentialIssuanceConfig": {
          "credentialType": "RefurbishmentCertificateCredential",
          "recipientParticipantId": "biomedical-engineer",
          "expiryDuration": "P365D",
          "claimMappings": [
            { "claimName": "certificateNumber", "sourceField": "/certificateNumber" },
            { "claimName": "deviceName", "sourceField": "/deviceName" },
            { "claimName": "deviceClass", "sourceField": "/deviceClass" },
            { "claimName": "manufacturer", "sourceField": "/manufacturer" },
            { "claimName": "serialNumber", "sourceField": "/serialNumber" },
            { "claimName": "riskCategory", "sourceField": "/riskCategory" },
            { "claimName": "workPerformed", "sourceField": "/workPerformed" },
            { "claimName": "safetyTestPassed", "sourceField": "/safetyTestPassed" },
            { "claimName": "returnToServiceDate", "sourceField": "/returnToServiceDate" }
          ],
          "disclosable": [
            "certificateNumber",
            "deviceName",
            "deviceClass",
            "manufacturer",
            "serialNumber",
            "returnToServiceDate"
          ]
        },
        "disclosures": [
          {
            "participantAddress": "lead-technician",
            "dataPointers": ["/*"]
          },
          {
            "participantAddress": "biomedical-engineer",
            "dataPointers": [
              "/certificateNumber",
              "/workPerformed",
              "/partsReplaced",
              "/testResults",
              "/safetyTestPassed",
              "/returnToServiceDate",
              "/estimatedCost"
            ]
          }
        ],
        "routes": [],
        "form": {
          "type": "Layout",
          "layout": "VerticalLayout",
          "title": "Refurbishment Completion & Certification",
          "elements": [
            {
              "type": "Layout",
              "layout": "Group",
              "title": "Work Summary",
              "elements": [
                {
                  "type": "TextArea",
                  "scope": "/workPerformed",
                  "title": "Work Performed"
                },
                {
                  "type": "TextArea",
                  "scope": "/partsReplaced",
                  "title": "Parts Replaced"
                }
              ]
            },
            {
              "type": "Layout",
              "layout": "Group",
              "title": "Testing & Certification",
              "elements": [
                {
                  "type": "TextArea",
                  "scope": "/testResults",
                  "title": "Post-Refurbishment Test Results"
                },
                {
                  "type": "Checkbox",
                  "scope": "/safetyTestPassed",
                  "title": "All safety tests passed successfully"
                },
                {
                  "type": "Layout",
                  "layout": "HorizontalLayout",
                  "elements": [
                    {
                      "type": "TextLine",
                      "scope": "/certificateNumber",
                      "title": "Certificate Number (e.g. RC-2026-00001)"
                    },
                    {
                      "type": "DateTime",
                      "scope": "/returnToServiceDate",
                      "title": "Return to Service Date"
                    }
                  ]
                }
              ]
            }
          ]
        }
      }
    ]
  },
  "parameterSchema": {
    "type": "object",
    "properties": {
      "biomedicalEngineerWallet": {
        "type": "string",
        "description": "Wallet address for the biomedical engineer (City General Hospital)"
      },
      "departmentHeadWallet": {
        "type": "string",
        "description": "Wallet address for the department head (City General Hospital)"
      },
      "leadTechnicianWallet": {
        "type": "string",
        "description": "Wallet address for the lead technician (MedTech Refurbishment Ltd)"
      },
      "complianceOfficerWallet": {
        "type": "string",
        "description": "Wallet address for the compliance officer (Regional Health Authority)"
      }
    },
    "required": [
      "biomedicalEngineerWallet",
      "departmentHeadWallet",
      "leadTechnicianWallet",
      "complianceOfficerWallet"
    ]
  },
  "defaultParameters": null,
  "examples": [
    {
      "name": "Scenario A: Routine Refurbishment",
      "description": "Class IIa device with electrical fault, routine risk category — skips regulatory review, 4 actions to certificate",
      "parameters": {
        "biomedicalEngineerWallet": "0xBIOMEDICAL_ENGINEER_WALLET",
        "departmentHeadWallet": "0xDEPARTMENT_HEAD_WALLET",
        "leadTechnicianWallet": "0xLEAD_TECHNICIAN_WALLET",
        "complianceOfficerWallet": "0xCOMPLIANCE_OFFICER_WALLET",
        "scenario": {
          "deviceName": "Philips IntelliVue MX800 Patient Monitor",
          "deviceClass": "Class IIa",
          "manufacturer": "Philips Healthcare",
          "serialNumber": "PHM-2021-44821",
          "failureType": "electrical",
          "failureDescription": "Intermittent power supply failure causing unexpected shutdowns during monitoring. PSU capacitors showing degradation on bench test.",
          "department": "Intensive Care Unit",
          "complexityFactor": 4,
          "urgency": "urgent"
        }
      }
    },
    {
      "name": "Scenario B: Safety-Critical Refurbishment",
      "description": "Class III device with safety failure — triggers regulatory hold and full compliance review, 5 actions",
      "parameters": {
        "biomedicalEngineerWallet": "0xBIOMEDICAL_ENGINEER_WALLET",
        "departmentHeadWallet": "0xDEPARTMENT_HEAD_WALLET",
        "leadTechnicianWallet": "0xLEAD_TECHNICIAN_WALLET",
        "complianceOfficerWallet": "0xCOMPLIANCE_OFFICER_WALLET",
        "scenario": {
          "deviceName": "Medtronic Lifepak 15 Defibrillator",
          "deviceClass": "Class III",
          "manufacturer": "Medtronic/Physio-Control",
          "serialNumber": "LP15-2020-78932",
          "failureType": "safety",
          "failureDescription": "Energy delivery inconsistency detected during routine testing. Device delivering 15-20% below selected energy level on internal discharge test. Potential patient safety risk.",
          "department": "Emergency Department",
          "complexityFactor": 7,
          "urgency": "critical"
        }
      }
    },
    {
      "name": "Scenario C: Rejection at Quote (Beyond Economical Repair)",
      "description": "Class IIb device rejected at quote stage — beyond economical repair, 3 actions",
      "parameters": {
        "biomedicalEngineerWallet": "0xBIOMEDICAL_ENGINEER_WALLET",
        "departmentHeadWallet": "0xDEPARTMENT_HEAD_WALLET",
        "leadTechnicianWallet": "0xLEAD_TECHNICIAN_WALLET",
        "complianceOfficerWallet": "0xCOMPLIANCE_OFFICER_WALLET",
        "scenario": {
          "deviceName": "GE Carescape B650 Patient Monitor",
          "deviceClass": "Class IIb",
          "manufacturer": "GE Healthcare",
          "serialNumber": "GEC-2018-33104",
          "failureType": "mechanical",
          "failureDescription": "Multiple board-level failures across power supply and signal processing modules. Water ingress damage from flood event. Corrosion visible on internal connectors and PCBs.",
          "department": "Cardiology Ward",
          "complexityFactor": 8,
          "urgency": "routine"
        }
      }
    }
  ]
}