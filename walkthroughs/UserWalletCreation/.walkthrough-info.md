# UserWalletCreation Walkthrough - Quick Reference

**Created:** 2026-01-04
**Status:** ðŸš§ Planning Phase
**Phase:** Planning Complete, Ready for Implementation

---

## Quick Info

| Attribute | Value |
|-----------|-------|
| **Walkthrough Name** | UserWalletCreation |
| **Purpose** | User management and wallet creation workflows |
| **Current Phase** | Phase 1 (Single User + Wallet) |
| **Implementation Status** | Planning complete, scripts pending |
| **Estimated Time** | 4-7 hours for Phase 1 implementation |
| **Priority** | P2 (Documentation/Testing) |

---

## What This Demonstrates

### Phase 1: Single User with Wallet âœ… Planned
- Creating a user in an existing organization (Tenant Service)
- User authentication with JWT tokens
- Wallet creation with HD wallet support (Wallet Service)
- Mnemonic phrase security and backup
- Wallet ownership verification
- Algorithm selection (ED25519, NIST P-256, RSA-4096)

### Phase 2: Multi-User Blueprint Sharing ðŸš§ Future
- Creating multiple users with unique wallets
- Deploying blueprints requiring multi-wallet interaction
- Cross-user data sharing and transaction signing
- Transaction chain verification

---

## Services Used

| Service | Port (Direct) | Endpoints Used |
|---------|---------------|----------------|
| **Tenant Service** | 5110 | POST /api/organizations/{id}/users<br>POST /api/auth/login |
| **Wallet Service** | 5000 | POST /api/v1/wallets<br>GET /api/v1/wallets |
| **API Gateway** | 80/443 | (Optional routing) |

---

## Key Technologies

- **Authentication:** JWT Bearer tokens with custom claims
- **Cryptography:** ED25519 (default), NIST P-256, RSA-4096
- **HD Wallets:** BIP32 (hierarchical), BIP39 (mnemonic), BIP44 (multi-account)
- **Multi-tenancy:** Organization isolation via PostgreSQL schemas
- **Security:** AES-256-GCM encryption at rest, BCrypt password hashing

---

## Files Structure

```
UserWalletCreation/
â”œâ”€â”€ README.md                           âœ… Created - Overview
â”œâ”€â”€ PLAN.md                             âœ… Created - Detailed plan
â”œâ”€â”€ .walkthrough-info.md                âœ… Created - This file
â”œâ”€â”€ PHASE1-RESULTS.md                   ðŸš§ Pending - After implementation
â”œâ”€â”€ PHASE2-RESULTS.md                   ðŸš§ Future
â”œâ”€â”€ scripts/
â”‚   â”œâ”€â”€ phase1-create-user-wallet.ps1  ðŸš§ Pending - Main script
â”‚   â”œâ”€â”€ test-user-login.ps1            ðŸš§ Pending - Auth testing
â”‚   â”œâ”€â”€ test-wallet-creation.ps1       ðŸš§ Pending - Wallet testing
â”‚   â””â”€â”€ helpers.ps1                     ðŸš§ Pending - Shared functions
â”œâ”€â”€ data/
â”‚   â”œâ”€â”€ test-users.json                ðŸš§ Pending - Sample users
â”‚   â””â”€â”€ wallet-configs.json            ðŸš§ Pending - Algorithm specs
â””â”€â”€ blueprints/
    â””â”€â”€ multi-user-data-share.json     ðŸš§ Future - Phase 2 blueprint
```

---

## Prerequisites

### Required
- âœ… Docker Desktop running
- âœ… Sorcha services deployed (`docker-compose up -d`)
- âœ… Platform bootstrapped (organization + admin user)
- âœ… PowerShell 7+ or Bash
- âœ… Network access to services (localhost)

### Optional
- ðŸ”² .NET 10 SDK (for local development)
- ðŸ”² Postman/Insomnia (for manual API testing)

---

## Success Criteria

### Phase 1
- [ ] Script creates user successfully via Tenant Service API
- [ ] User can authenticate and obtain JWT token
- [ ] User can create default wallet via Wallet Service API
- [ ] Mnemonic phrase displayed with security warnings
- [ ] Wallet ownership verified (user can list their wallets)
- [ ] Multiple algorithm support tested (ED25519, NIST P-256, RSA-4096)
- [ ] Error handling works (duplicate user, invalid token, etc.)
- [ ] Documentation is clear and actionable

### Phase 2 (Future)
- [ ] Multiple users created with unique wallets
- [ ] Blueprint deployed requiring multi-wallet signatures
- [ ] Blueprint execution with cross-user data sharing
- [ ] Transaction chain verified on Register Service

---

## Next Steps

### For Implementation (After User Approval)
1. âœ… Planning documents created
2. ðŸš§ Implement `phase1-create-user-wallet.ps1` script
3. ðŸš§ Implement helper scripts (login test, wallet test)
4. ðŸš§ Create sample data files (test-users.json, wallet-configs.json)
5. ðŸš§ Test with running Sorcha instance
6. ðŸš§ Document results in PHASE1-RESULTS.md
7. ðŸš§ Update main walkthroughs README with status

### For Phase 2 (Future)
1. ðŸš§ Design multi-user blueprint (invoice approval workflow)
2. ðŸš§ Implement Phase 2 scripts
3. ðŸš§ Test end-to-end multi-wallet scenario
4. ðŸš§ Document in PHASE2-RESULTS.md

---

## API Examples

### Create User
```http
POST http://localhost:5110/api/organizations/{orgId}/users
Authorization: Bearer {adminToken}
Content-Type: application/json

{
  "email": "alice@example.com",
  "displayName": "Alice Johnson",
  "password": "SecurePass123!",
  "roles": ["Member", "Designer"]
}
```

### User Login
```http
POST http://localhost:5110/api/auth/login
Content-Type: application/json

{
  "email": "alice@example.com",
  "password": "SecurePass123!"
}
```

### Create Wallet
```http
POST http://localhost:5000/api/v1/wallets
Authorization: Bearer {userToken}
Content-Type: application/json

{
  "name": "Alice's Primary Wallet",
  "algorithm": "ED25519",
  "wordCount": 12
}
```

---

## Related Walkthroughs

| Walkthrough | Relationship |
|-------------|--------------|
| **BlueprintStorageBasic** | Prerequisite - Bootstrap platform |
| **AdminIntegration** | Related - UI for user/wallet management |
| **Future: BlueprintExecution** | Next step - Execute blueprints with wallets |

---

## Resources

### Documentation
- [README.md](./README.md) - User-facing walkthrough guide
- [PLAN.md](./PLAN.md) - Detailed implementation plan
- [Wallet Service Spec](../../.specify/specs/sorcha-wallet-service.md)
- [Tenant Service Spec](../../.specify/specs/sorcha-tenant-service.md)

### API Docs
- Tenant Service: http://localhost:5110/scalar
- Wallet Service: http://localhost:5000/scalar
- API Gateway: http://localhost/scalar

### External Standards
- [BIP32: HD Wallets](https://github.com/bitcoin/bips/blob/master/bip-0032.mediawiki)
- [BIP39: Mnemonic Phrases](https://github.com/bitcoin/bips/blob/master/bip-0039.mediawiki)
- [BIP44: Multi-Account Hierarchy](https://github.com/bitcoin/bips/blob/master/bip-0044.mediawiki)

---

## Notes for Maintainers

### Key Design Decisions
1. **PowerShell First:** Primary scripts in PowerShell for Windows compatibility
2. **Direct API Calls:** Use REST APIs directly (not Sorcha CLI) for transparency
3. **Security Focus:** Strong emphasis on mnemonic security and warnings
4. **Modular Design:** Separate scripts for different test scenarios
5. **Real Data:** Use actual JSON data files for realistic testing

### Testing Strategy
- Manual testing first (interactive script execution)
- Automated testing with sample data files
- Edge case testing (conflicts, errors, timeouts)
- Performance testing (100+ users) for Phase 2

### Future Enhancements
- Bash versions of all scripts (cross-platform)
- Wallet recovery walkthrough (separate or Phase 3)
- HD wallet address derivation examples
- Multi-signature wallet scenarios
- Integration with Blueprint execution walkthrough

---

**Status:** Planning Complete âœ…

**Ready for Implementation:** Yes, awaiting user approval

**Questions for User:** See [PLAN.md](./PLAN.md) - "Questions for User" section
